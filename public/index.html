<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web Calendar â€“ Setup</title>
  <style>
    :root {
      --cfg-bg: #f8f9fa;
      --cfg-card: #ffffff;
      --cfg-border: #e2e8f0;
      --cfg-text: #1a202c;
      --cfg-muted: #718096;
      --cfg-accent: #4f6ef7;
      --cfg-radius: 10px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--cfg-bg);
      color: var(--cfg-text);
      min-height: 100vh;
    }

    .page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
    }

    .page-header {
      margin-bottom: 2.5rem;
    }
    .page-header h1 {
      font-size: 1.6rem;
      font-weight: 700;
    }
    .page-header p {
      color: var(--cfg-muted);
      margin-top: 0.35rem;
      font-size: 0.95rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 2rem;
      align-items: start;
    }

    /* ---- Settings panel ---- */
    .settings {
      background: var(--cfg-card);
      border: 1px solid var(--cfg-border);
      border-radius: var(--cfg-radius);
      padding: 1.5rem;
      position: sticky;
      top: 1.5rem;
    }
    .settings h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
    }

    .field {
      margin-bottom: 1.25rem;
    }
    .field:last-child { margin-bottom: 0; }
    .field label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--cfg-muted);
      margin-bottom: 0.4rem;
    }
    .field input[type="url"],
    .field input[type="text"] {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border: 1px solid var(--cfg-border);
      border-radius: 8px;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
      font-family: inherit;
    }
    .field input[type="url"]:focus,
    .field input[type="text"]:focus {
      border-color: var(--cfg-accent);
    }
    .field select {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border: 1px solid var(--cfg-border);
      border-radius: 8px;
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
      background: var(--cfg-card);
      color: var(--cfg-text);
      cursor: pointer;
    }
    .field select:focus {
      border-color: var(--cfg-accent);
    }

    .color-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .color-row input[type="color"] {
      -webkit-appearance: none;
      appearance: none;
      width: 42px;
      height: 42px;
      border: 2px solid var(--cfg-border);
      border-radius: 8px;
      padding: 2px;
      cursor: pointer;
      background: none;
    }
    .color-row input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
    .color-row input[type="color"]::-webkit-color-swatch { border: none; border-radius: 5px; }
    .color-row input[type="color"]::-moz-color-swatch { border: none; border-radius: 5px; }
    .color-row input[type="text"] {
      flex: 1;
    }

    .range-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .range-row input[type="range"] {
      flex: 1;
      accent-color: var(--cfg-accent);
    }
    .range-row .range-val {
      font-size: 0.85rem;
      font-weight: 500;
      min-width: 3.2em;
      text-align: right;
      color: var(--cfg-muted);
    }

    .field-divider {
      border: none;
      border-top: 1px solid var(--cfg-border);
      margin: 1.25rem 0;
    }

    .btn-load {
      width: 100%;
      padding: 0.7rem;
      background: var(--cfg-accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
      font-family: inherit;
      margin-top: 0.25rem;
    }
    .btn-load:hover { opacity: 0.85; }

    /* ---- Preview area ---- */
    .preview-area h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    #preview { min-height: 200px; }

    /* ---- Snippet area ---- */
    .snippet-section {
      margin-top: 2rem;
    }
    .snippet-section h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    .snippet-wrap {
      position: relative;
      background: #1a202c;
      border-radius: var(--cfg-radius);
      padding: 1.2rem 1.2rem 1.2rem 1.2rem;
    }
    .snippet-wrap pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
      font-family: "SF Mono", "Fira Code", "Cascadia Code", Menlo, monospace;
      font-size: 0.82rem;
      line-height: 1.7;
      color: #e2e8f0;
    }
    .btn-copy {
      position: absolute;
      top: 0.6rem;
      right: 0.6rem;
      padding: 0.35rem 0.8rem;
      background: rgba(255,255,255,0.25);
      color: #e2e8f0;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      font-size: 0.78rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
      font-family: inherit;
    }
    .btn-copy:hover { background: rgba(255,255,255,0.4); }

    /* responsive */
    @media (max-width: 740px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .settings {
        position: static;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="page-header">
      <h1>Web Calendar</h1>
      <p>Configure your calendar widget, preview it, and copy the embed snippet.</p>
    </div>

    <div class="layout">
      <!-- Settings panel -->
      <div class="settings">
        <h2>Settings</h2>

        <div class="field">
          <label for="icsUrl">ICS Feed URL</label>
          <input id="icsUrl" type="url" placeholder="https://example.com/feed.ics" />
        </div>

        <div class="field">
          <label>Accent Color</label>
          <div class="color-row">
            <input id="accentPicker" type="color" value="#4f6ef7" />
            <input id="accentHex" type="text" value="#4f6ef7" maxlength="7" />
          </div>
        </div>

        <hr class="field-divider" />

        <div class="field">
          <label>Background Color</label>
          <div class="color-row">
            <input id="bgPicker" type="color" value="#f8f9fa" />
            <input id="bgHex" type="text" value="#f8f9fa" maxlength="7" />
          </div>
        </div>

        <div class="field">
          <label>Text Color</label>
          <div class="color-row">
            <input id="textPicker" type="color" value="#1a202c" />
            <input id="textHex" type="text" value="#1a202c" maxlength="7" />
          </div>
        </div>

        <div class="field">
          <label>Card Color</label>
          <div class="color-row">
            <input id="cardPicker" type="color" value="#ffffff" />
            <input id="cardHex" type="text" value="#ffffff" maxlength="7" />
          </div>
        </div>

        <div class="field">
          <label>Border Radius</label>
          <div class="range-row">
            <input id="radiusSlider" type="range" min="0" max="24" value="10" />
            <span class="range-val" id="radiusVal">10px</span>
          </div>
        </div>

        <div class="field">
          <label for="viewSelect">Default View</label>
          <select id="viewSelect">
            <option value="week" selected>Week</option>
            <option value="day">Day</option>
            <option value="month">Month</option>
            <option value="next">Next</option>
          </select>
        </div>

        <button class="btn-load" id="loadBtn">Load Calendar</button>
      </div>

      <!-- Preview + snippet -->
      <div>
        <div class="preview-area">
          <h2>Preview</h2>
          <div id="preview"></div>
        </div>

        <div class="snippet-section">
          <h2>Embed Snippet</h2>
          <div class="snippet-wrap">
            <button class="btn-copy" id="copyBtn">Copy</button>
            <pre id="snippetCode"></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="web-calendar.js"></script>
  <script>
    var icsInput    = document.getElementById("icsUrl");
    var accentPick  = document.getElementById("accentPicker");
    var accentHex   = document.getElementById("accentHex");
    var bgPick      = document.getElementById("bgPicker");
    var bgHex       = document.getElementById("bgHex");
    var textPick    = document.getElementById("textPicker");
    var textHex     = document.getElementById("textHex");
    var cardPick    = document.getElementById("cardPicker");
    var cardHex     = document.getElementById("cardHex");
    var radiusSlider = document.getElementById("radiusSlider");
    var radiusVal   = document.getElementById("radiusVal");
    var viewSelect  = document.getElementById("viewSelect");
    var loadBtn     = document.getElementById("loadBtn");
    var copyBtn     = document.getElementById("copyBtn");
    var snippetEl   = document.getElementById("snippetCode");
    var previewEl   = document.getElementById("preview");

    var D = WebCalendar.DEFAULTS;
    var cal = null;

    function escHtml(s) {
      var d = document.createElement("div");
      d.textContent = s;
      return d.innerHTML;
    }

    function val(hexInput, def) {
      return hexInput.value.trim() || def;
    }

    function isDefault(v, def) {
      return v.toLowerCase() === def.toLowerCase();
    }

    function scriptSrc() {
      var host = location.hostname;
      if (host === "localhost" || host === "127.0.0.1") return "https://your-server.com/web-calendar.js";
      return location.origin + "/web-calendar.js";
    }

    function updateSnippet() {
      var url = icsInput.value.trim();
      var accent = val(accentHex, D.accent);
      var bg = val(bgHex, D.bg);
      var tc = val(textHex, D.textColor);
      var cc = val(cardHex, D.cardColor);
      var r = radiusSlider.value;

      var vw = viewSelect.value;

      var attrs = 'data-web-calendar';
      if (url)                    attrs += ' data-url="' + escHtml(url) + '"';
      if (!isDefault(vw, D.view))          attrs += ' data-view="' + escHtml(vw) + '"';
      if (!isDefault(accent, D.accent))     attrs += ' data-accent="' + escHtml(accent) + '"';
      if (!isDefault(bg, D.bg))             attrs += ' data-bg="' + escHtml(bg) + '"';
      if (!isDefault(tc, D.textColor))      attrs += ' data-text-color="' + escHtml(tc) + '"';
      if (!isDefault(cc, D.cardColor))      attrs += ' data-card-color="' + escHtml(cc) + '"';
      if (r !== D.radius)                   attrs += ' data-radius="' + escHtml(r) + '"';

      var snippet =
        '&lt;div ' + attrs + '&gt;&lt;/div&gt;\n' +
        '&lt;script src="' + escHtml(scriptSrc()) + '"&gt;&lt;/script&gt;';

      snippetEl.innerHTML = snippet;
    }

    function initPreview() {
      previewEl.innerHTML = "";
      cal = new WebCalendar(previewEl, {
        accent: val(accentHex, D.accent),
        bg: val(bgHex, D.bg),
        textColor: val(textHex, D.textColor),
        cardColor: val(cardHex, D.cardColor),
        radius: radiusSlider.value,
        view: viewSelect.value,
        noInput: true
      });
      updateSnippet();
    }

    function loadFeed() {
      var url = icsInput.value.trim();
      if (!url || !cal) return;
      cal.loadFeed(url);
      updateSnippet();
    }

    function bindColorPair(picker, hex, optionKey) {
      picker.addEventListener("input", function () {
        hex.value = this.value;
        if (cal) cal.setOption(optionKey, this.value);
        updateSnippet();
      });
      hex.addEventListener("input", function () {
        var v = this.value.trim();
        if (/^#[0-9a-f]{6}$/i.test(v)) {
          picker.value = v;
          if (cal) cal.setOption(optionKey, v);
        }
        updateSnippet();
      });
    }

    bindColorPair(accentPick, accentHex, "accent");
    bindColorPair(bgPick, bgHex, "bg");
    bindColorPair(textPick, textHex, "textColor");
    bindColorPair(cardPick, cardHex, "cardColor");

    radiusSlider.addEventListener("input", function () {
      radiusVal.textContent = this.value + "px";
      if (cal) cal.setOption("radius", this.value);
      updateSnippet();
    });

    viewSelect.addEventListener("change", function () {
      if (cal) cal.setOption("view", this.value);
      updateSnippet();
    });

    icsInput.addEventListener("input", updateSnippet);
    loadBtn.addEventListener("click", loadFeed);
    icsInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") loadFeed();
    });

    copyBtn.addEventListener("click", function () {
      var text = snippetEl.textContent;
      navigator.clipboard.writeText(text).then(function () {
        copyBtn.textContent = "Copied!";
        setTimeout(function () { copyBtn.textContent = "Copy"; }, 1500);
      });
    });

    initPreview();
  </script>
</body>
</html>
